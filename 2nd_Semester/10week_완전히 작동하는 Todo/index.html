<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Todo 클라이언트</title>
    <style>
        /* --- (1) 기본 스타일 및 레이아웃 --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
                         Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f4f7f6; /* 옅은 회색 배경 */
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex; /* 내용을 수직/수평 중앙 정렬 */
            justify-content: center;
            align-items: center;
            min-height: 90vh; /* 최소 높이 */
        }

        /* --- (2) 전체를 감싸는 흰색 카드 --- */
        .container {
            width: 100%;
            max-width: 700px; /* 최대 너비 고정 */
            background-color: #ffffff;
            border-radius: 10px; /* 둥근 모서리 */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); /* 그림자 효과 */
            padding: 20px 40px; /* 내부 여백 */
            box-sizing: border-box;
        }

        h1, h2 {
            color: #2c3e50;
            border-bottom: 2px solid #ecf0f1; /* 구분선 */
            padding-bottom: 10px;
        }
        h1 { text-align: center; }

        /* --- (3) 폼 스타일 (항목 추가) --- */
        .add-todo-form div {
            margin-bottom: 15px; /* 입력 필드 간 여백 */
        }
        .add-todo-form label {
            display: inline-block;
            width: 60px; /* "ID:", "내용:" 라벨 정렬 */
            font-weight: bold;
            color: #555;
        }

        /* --- (4) 입력창(input) 스타일 --- */
        input[type="text"], input[type="number"] {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            width: 280px; /* 너비 통일 */
            box-sizing: border-box;
            transition: all 0.2s ease;
        }
        input:focus {
            outline: none;
            border-color: #3498db; /* 포커스 시 파란색 테두리 */
            box-shadow: 0 0 5px rgba(52,152,219,0.5); /* 은은한 그림자 */
        }
        
        /* 리스트 안의 입력창은 너비를 유연하게 */
        #todo-list input[type="text"] {
            flex-grow: 1; /* 남은 공간 모두 차지 */
            width: auto;
            margin-right: 10px;
        }

        /* --- (5) 버튼 스타일 --- */
        button {
            padding: 10px 15px;
            font-size: 14px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
            background-color: #3498db; /* 기본 파란색 버튼 */
        }
        button:hover {
            opacity: 0.85; /* 마우스 올리면 살짝 투명하게 */
        }

        /* 버튼별 색상 지정 */
        #btn-get-all { background-color: #2ecc71; margin-bottom: 15px; } /* 초록색 */
        #btn-add { background-color: #3498db; } /* 파란색 */
        .btn-update { background-color: #f39c12; margin-left: 5px; } /* 주황색 */
        .btn-delete { background-color: #e74c3c; margin-left: 5px; } /* 빨간색 */

        /* --- (6) Todo 리스트 (ul, li) 스타일 --- */
        #todo-list {
            list-style-type: none; /* 점(bullet) 제거 */
            padding-left: 0;
            margin-top: 10px;
        }
        #todo-list li {
            display: flex; /* 항목들을 가로로 정렬 */
            align-items: center; /* 수직 중앙 정렬 */
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
            background-color: #fafafa;
            margin-bottom: 8px;
            border-radius: 5px;
        }
        /* [ID: X] 텍스트 스타일 */
        #todo-list li span { 
            font-weight: bold;
            color: #7f8c8d;
            margin-right: 10px;
            min-width: 50px;
        }

        /* --- (7) 기타 --- */
        .info-text {
            font-size: 12px;
            color: #95a5a6;
            text-align: center;
        }

    </style>
</head>
<body>
    
    <div class="container">
        <h1>Todo 리스트 클라이언트</h1>

        <h2>전체 목록</h2>
        <button id="btn-get-all">목록 새로고침</button>
        <ul id="todo-list">
            </ul>
        <p class="info-text">
            * 한글(????)은 `curl` 테스트 시 인코딩 문제이며, 지금 여기서 추가하면 정상 등록됩니다.
        </p>

        <h2>새 항목 추가</h2>
        <div class="add-todo-form">
            <div>
                <label for="new-id">ID: </label>
                <input type="number" id="new-id" placeholder="예: 3">
            </div>
            <div>
                <label for="new-item">내용: </label>
                <input type="text" id="new-item" placeholder="예: JavaScript 공부하기">
            </div>
            <button id="btn-add">추가하기</button>
        </div>
    </div>
    
    <script>
        // --- JavaScript 로직 (기능은 동일, CSS 클래스 추가만 변경) ---
        const API_URL = 'http://127.0.0.1:8000';

        // 1. (GET) 전체 목록 조회 함수
        async function fetchTodos() {
            try {
                const response = await fetch(`${API_URL}/retrieve_todo`);
                if (!response.ok) throw new Error('서버 응답 실패');
                
                const data = await response.json();
                const todoListElement = document.getElementById('todo-list');
                
                todoListElement.innerHTML = ''; 

                data.todos.forEach(todo => {
                    const li = document.createElement('li');
                    
                    // (JS 변경) [ID: X] 텍스트를 위한 span 생성
                    const spanId = document.createElement('span');
                    spanId.textContent = `[ID: ${todo.id}]`;

                    // (JS 변경) 수정용 입력 상자
                    const updateInput = document.createElement('input');
                    updateInput.type = 'text';
                    updateInput.value = todo.item;
                    
                    // (JS 변경) 수정 버튼
                    const updateButton = document.createElement('button');
                    updateButton.textContent = '수정';
                    updateButton.className = 'btn-update'; // CSS 적용을 위한 클래스 추가
                    updateButton.onclick = () => updateTodo(todo.id, updateInput.value);

                    // (JS 변경) 삭제 버튼
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = '삭제';
                    deleteButton.className = 'btn-delete'; // CSS 적용을 위한 클래스 추가
                    deleteButton.onclick = () => deleteTodo(todo.id);

                    // (JS 변경) li에 자식 요소들 순서대로 추가
                    li.appendChild(spanId);
                    li.appendChild(updateInput);
                    li.appendChild(updateButton);
                    li.appendChild(deleteButton);
                    
                    todoListElement.appendChild(li);
                });

            } catch (error) {
                console.error('목록 조회 실패:', error);
                alert('목록을 불러오는 데 실패했습니다.');
            }
        }

        // 2. (POST) 새 항목 추가 함수
        async function addTodo() {
            const idInput = document.getElementById('new-id');
            const itemInput = document.getElementById('new-item');
            
            const newTodo = {
                id: parseInt(idInput.value),
                item: itemInput.value
            };

            // ID나 내용이 비어있으면 경고
            if (!newTodo.id || !newTodo.item) {
                alert('ID와 내용을 모두 입력하세요.');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/add_todo`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newTodo)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || '추가 실패');
                }
                
                alert('추가 성공!');
                idInput.value = ''; // 입력창 비우기
                itemInput.value = '';
                fetchTodos(); // 목록 새로고침

            } catch (error) {
                console.error('추가 실패:', error);
                alert(`추가 실패: ${error.message}`);
            }
        }

        // 3. (PUT) 항목 수정 함수
        async function updateTodo(id, newItem) {
            try {
                const response = await fetch(`${API_URL}/update_todo/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ item: newItem }) // 모델(TodoItem)에 맞게 item만 전송
                });

                if (!response.ok) throw new Error('수정 실패');
                
                alert('수정 성공!');
                fetchTodos(); // 목록 새로고침

            } catch (error) {
                console.error('수정 실패:', error);
                alert('수정 실패');
            }
        }

        // 4. (DELETE) 항목 삭제 함수
        async function deleteTodo(id) {
            if (!confirm(`[ID: ${id}] 항목을 정말 삭제하시겠습니까?`)) {
                return; // 사용자가 '취소'를 누름
            }

            try {
                const response = await fetch(`${API_URL}/delete_single_todo/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('삭제 실패');

                alert('삭제 성공!');
                fetchTodos(); // 목록 새로고침

            } catch (error) {
                console.error('삭제 실패:', error);
                alert('삭제 실패');
            }
        }

        // --- 이벤트 리스너 연결 ---
        // '목록 새로고침' 버튼 클릭 시
        document.getElementById('btn-get-all').addEventListener('click', fetchTodos);
        
        // '추가하기' 버튼 클릭 시
        document.getElementById('btn-add').addEventListener('click', addTodo);

        // 페이지 로드 시 처음에 한 번 목록을 불러옴
        fetchTodos();

    </script>
</body>
</html>